---
version: "3.1"

services:
  server:
    build: .
    security_opt:
      - label=disable
    volumes:
      - ./shared/consul.key:/shared/consul.key:ro
      - ./shared/nomad.key:/shared/nomad.key:ro
    ports:
      - "4646:4646"

  client:
    deploy:
      replicas: 3
    build: .
    security_opt:
      - label=disable
    devices:
      - /dev/fuse:/dev/fuse
    volumes:
      - ./shared/consul.key:/shared/consul.key:ro
    depends_on:
      - server
